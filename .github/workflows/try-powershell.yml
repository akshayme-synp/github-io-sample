name: "Try powershell"

on:
  push:
   branches: [ master ]

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write
    
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0  # OR "2" -> To retrieve the preceding commit.
        
    - name: Run powershell
      shell: pwsh
      id: prescription
      run: |
        .\prescription.ps1 -stage 'io' `
          -io_url '${{secrets.IO_SERVER_URL}}' `
          -io_token '${{secrets.IO_SERVER_TOKEN}}' `
          -project_name 'akshayme-synp/insecure-bank' `
          -scm_type 'github' `
          -scm_owner 'akshayme-synp' `
          -scm_repo_name 'insecure-bank' `
          -scm_branch_name 'master' `
          -github_username 'akshayme-synp' `
          -github_access_token '${{secrets.SCM_ACCESS_TOKEN}}' `
          -gitlab_url 'https://www.gitlab.com' `
          -gitlab_token '' `
          -persona 'developer' `
          -release_type 'minor' `
          -polaris_project_name 'akshayme-synp/insecure-bank' `
          -polaris_server_url '${{secrets.POLARIS_SERVER_URL}}' `
          -polaris_access_token '${{secrets.POLARIS_ACCESS_TOKEN}}' `
          -is_sast_enabled 'true'
        echo "::set-output name=isSastEnabled::${isSastEnabled}"
        if($isSastEnabled -eq $true) {
            Write-Host "Run polaris..."
        } else {
            Write-Host "Don't run polaris..."
        }
          
    - name: Check outputs
      shell: pwsh
      run: echo ${{ steps.prescription.outputs.isSastEnabled }}
